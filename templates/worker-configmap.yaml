apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "sccache.fullname" . }}-worker-config
  labels:
    app.kubernetes.io/component: worker
    {{- include "sccache.labels" . | nindent 4 }}
data:
  worker.conf: |
    cache_dir = "/cache"
    public_addr = "127.0.0.1:10501"
    scheduler_url = "{{ printf "http://%s-scheduler:7634" (include "sccache.fullname" .) }}"

    [builder]
    type = "overlay"
    # The directory under which a sandboxed filesystem will be created for builds.
    build_dir = "/tmp/build"
    # The path to the bubblewrap version 0.3.0+ `bwrap` binary.
    bwrap_path = "/usr/bin/bwrap"

    [scheduler_auth]
    type = "jwt_token"
    token = "{{ .Values.app.token }}"
    
    {{- with .Values.worker.extra_config }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
